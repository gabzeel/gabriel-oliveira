---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseLayout from "../../components/layouts/BaseLayout.astro";
import FormattedDate from "../../components/FormattedDate";
import FallbackImage from "../../assets/blog-placeholder-1.jpg";
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "../../components/ui/card";
import { ArrowLeft } from "lucide-react";

const title = "Blog";
const description = "Ideias e pensamentos do Gabriel Oliveira";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const imageUrl = new URL(FallbackImage.src, Astro.url);
---

<BaseLayout
  title={title}
  description={description}
  imageUrl={imageUrl.toString()}
>
  <main class="mx-auto w-full max-w-4xl px-4 py-10">
    <div class="mb-8">
      <a
        href="/"
        class="inline-flex items-center gap-1.5 text-sm text-muted-foreground transition-colors hover:text-foreground"
      >
        <ArrowLeft className="size-3.5" />
        Voltar
      </a>
    </div>

    <header class="mb-12">
      <h1
        class="text-3xl font-bold tracking-tight text-foreground text-balance"
      >
        Blog
      </h1>
      <p
        class="mt-2 text-base leading-relaxed text-muted-foreground text-pretty"
      >
        Um pouco das minhas ideias e pensamentos sobre assuntos variados.
      </p>
    </header>

    {
      posts.length === 0 ? (
        <div class="px-6 py-12 text-center text-sm text-slate-500 mt-36">
          Nenhuma ideia ou pensamento para mostrar por enquanto.
          <br />
          Volte em breve.
        </div>
      ) : (
        <section class="grid gap-6 sm:grid-cols-2">
          {posts.map((post) => (
            <Card className="pt-0">
              <a href={`/blog/${post.id}/`} class="block">
                {post.data.heroImage && (
                  <Image
                    width={720}
                    height={360}
                    src={post.data.heroImage}
                    alt={post.data.title}
                    class="w-full rounded-t-lg"
                  />
                )}
                <CardHeader>
                  <CardTitle>{post.data.title}</CardTitle>
                </CardHeader>
                <CardContent className="pt-0">
                  <p class="text-sm text-slate-500">
                    <FormattedDate date={post.data.pubDate} />
                  </p>
                </CardContent>
              </a>
            </Card>
          ))}
        </section>
      )
    }
  </main>
</BaseLayout>
